(function(e){var t=null;e.fn.railsAutocomplete=function(){var t=function(){if(!this.railsAutoCompleter){this.railsAutoCompleter=new e.railsAutocomplete(this)}};if(e.fn.on!==undefined){elems=$(this.selector);for(i=0;i<elems.length;i++){ac=$(elems[i]);if(ac.data("autocomplete-dropdown")&&!ac.hasClass("ui-autocomplete-input")){this.railsAutoCompleter=new e.railsAutocomplete(ac)}else{$(document).on("focus",ac,t)}}}else{return this.live("focus",t)}};e.railsAutocomplete=function(e){_e=e;this.init(_e)};e.railsAutocomplete.fn=e.railsAutocomplete.prototype={railsAutocomplete:"0.0.2"};e.railsAutocomplete.fn.extend=e.railsAutocomplete.extend=e.extend;e.railsAutocomplete.fn.extend({init:function(t){function n(e){return e.split(t.delimiter)}function r(e){return n(e).pop().replace(/^\s+/,"")}if(e(t).attr("data-autocomplete-minlength")){t.autocomplete({minLength:e(t).attr("data-autocomplete-minlength")})}if(e(t).attr("data-autocomplete-dropdown")){this.wrapper=$("<span>").addClass("custom-combobox").insertAfter(t);wasOpen=false;$("<a>").attr("title",e(t).attr("data-autocomplete-dropdown")).appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right").mousedown(function(){wasOpen=e(t).autocomplete("widget").is(":visible")}).click(function(e){input=$(e.currentTarget).parents("div.autocompleter").children("input[data-autocomplete]");input.focus();if(wasOpen){return}input.autocomplete("search")})}t.delimiter=e(t).attr("data-delimiter")||null;e(t).autocomplete({source:function(n,i){e.getJSON(e(t).attr("data-autocomplete"),{term:r(n.term)},function(){if(arguments[0].length==0){var n="No existing matches";if(e(t).attr("data-autocomplete-label")!==undefined){n=e(t).attr("data-autocomplete-label")}arguments[0]=[];arguments[0][0]={id:"",label:n}}e(arguments[0]).each(function(n,r){var i={};i[r.id]=r;e(t).data(i)});i.apply(null,arguments)})},change:function(t,n){if(e(e(this).attr("data-id-element")).val()==""){return}e(e(this).attr("data-id-element")).val(n.item?n.item.id:e(e(this).attr("data-id-element")).val());var r=e.parseJSON(e(this).attr("data-update-elements"));var i=n.item?e(this).data(n.item.id.toString()):{};if(r&&e(r["id"]).val()==""){return}for(var s in r){e(r[s]).val(n.item?i[s]:"")}},search:function(){var n=r(this.value);var i=0;if(e(t).attr("data-autocomplete-minlength")!==undefined){i=e(t).attr("data-autocomplete-minlength")}if(n.length<i){return false}},focus:function(){return false},open:function(e,t){$("ul.ui-autocomplete.ui-menu .ui-menu-item:even").addClass("ui-menu-item-even");$("ul.ui-autocomplete.ui-menu .ui-menu-item:odd").addClass("ui-menu-item-odd")},select:function(r,i){var s=n(this.value);s.pop();s.push(i.item.value);if(t.delimiter!=null){s.push("");this.value=s.join(t.delimiter)}else{this.value=s.join("");if(e(this).attr("data-id-element")){e(e(this).attr("data-id-element")).val(i.item.id)}if(e(this).attr("data-update-elements")){var o=e(this).data(i.item.id.toString());var u=e.parseJSON(e(this).attr("data-update-elements"));for(var a in u){e(u[a]).val(o[a])}}}var f=this.value;e(this).bind("keyup.clearId",function(){if(e(this).val().trim()!=f.trim()){e(e(this).attr("data-id-element")).val("");e(this).unbind("keyup.clearId")}});e(t).trigger("railsAutocomplete.select",i);return false}})}});e(document).ready(function(){e("input[data-autocomplete]").railsAutocomplete()})})(jQuery)
